apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: identity-service-api-deployment
  namespace: default
  labels:
    app: identity-service-api
spec:
  replicas: 1
  selector:
    matchLabels:
      app: identity-service-api
  template:
    metadata:
      name: identity-service-api
      labels:
        app: identity-service-api
    spec:
      containers:
        - name: identity-service-api
          image: workflowmanager.azurecr.io/workflow-manager-identity-service-api:v0.1.0
          imagePullPolicy: "Always"
          resources:
              limits:
                cpu: 1Gi
                memory: 1Gi
          env:
            - name: ConnectionStrings__MsSqlDatabase
              value: "Data Source=identity-service-mssql-service;User ID=sa;Password=Your_password123;Connect Timeout=30;Encrypt=False;TrustServerCertificate=False;ApplicationIntent=ReadWrite;MultiSubnetFailover=False"
            - name: ASPNETCORE_ENVIRONMENT
              value: Docker
            - name: ASPNETCORE_BASE_LOG_DIR
              value: ../var/log/identity-service-api
          volumeMounts:
            - name: identity-service-api-logs
              mountPath: /var/log/identity-service-api
      volumes:
        - name: identity-service-api-logs
          hostPath:
            path: /var/log/containers
